.dashboard-app data-dashboard-app="" data-student-dashboard="true"
  = render 'student_dashboard/sidebar'

  main.dashboard-main
    header.dashboard-top-bar
      button.dashboard-sidebar-toggle type="button" aria-label="PrzeÅ‚Ä…cz nawigacjÄ™" data-sidebar-toggle=""
        = image_tag 'icons/social/M/burger.svg', width: 24, height: 24, data: { theme_icon: true }
      .dashboard-top-heading
        h1 = @subject.title
      .dashboard-top-actions
        = render 'student_dashboard/top_actions'

    section.quiz-result-section
      .quiz-result-container
        - if @current_passed
          .quiz-result-icon ðŸŽ‰
          h2.quiz-result-title Gratulacje!
          p.quiz-result-score
            | ZdobyÅ‚eÅ› 
            strong = "#{@current_score} pkt"
            |  w quizie!
          p.quiz-result-message
            | Åšwietna robota â€” moÅ¼esz teraz pobraÄ‡ swÃ³j certyfikat i pochwaliÄ‡ siÄ™ swoim wynikiem! ðŸ¤˜
        - else
          .quiz-result-icon ðŸ“š
          h2.quiz-result-title SprÃ³buj ponownie
          p.quiz-result-score
            | ZdobyÅ‚eÅ› 
            strong = "#{@current_score} pkt"
            |  w quizie.
          p.quiz-result-message
            | Potrzebujesz minimum 80 punktÃ³w, Å¼eby zdaÄ‡. Przejrzyj materiaÅ‚y i sprÃ³buj ponownie!

        .quiz-result-details
          .quiz-result-stat
            span.quiz-result-stat__label Poprawne odpowiedzi
            span.quiz-result-stat__value
              = @quiz_result.details&.dig('correct_count') || 0
              | /
              = @quiz_result.details&.dig('total') || 0
          .quiz-result-stat
            span.quiz-result-stat__label Wynik
            span.quiz-result-stat__value class=(@current_passed ? 'text-success' : 'text-error')
              = "#{@current_score}%"
          - if @best_score != @current_score
            .quiz-result-stat
              span.quiz-result-stat__label Najlepszy wynik
              span.quiz-result-stat__value.text-success
                = "#{@best_score}%"

        .quiz-result-actions
          = link_to public_home_path, class: 'quiz-result-link'
            | POMIÅƒ
          - if @current_passed && @quiz_result.certificate
            = link_to download_api_v1_certificate_path(@quiz_result.certificate.id), class: 'quiz-result-btn', target: '_blank'
              i.bi.bi-file-earmark-pdf-fill style="margin-right: 8px;"
              | POBIERZ CERTYFIKAT
          - else
            = link_to student_module_path(@learning_module), class: 'quiz-result-btn'
              | POWTÃ“RZ MATERIAÅ

        - if @current_passed && @quiz_result.certificate
          .quiz-result-share
            h3.quiz-result-share__title Podziel siÄ™ swoim osiÄ…gniÄ™ciem!
            p.quiz-result-share__text Zeskanuj kod QR lub skopiuj link do certyfikatu
            .quiz-result-share__qr
              = render_qr_svg(public_certificate_url(@quiz_result.certificate.id), size: 150)
            .quiz-result-share__link
              input.quiz-result-share__input type="text" readonly="" value=public_certificate_url(@quiz_result.certificate.id) id="certificate-link"
              button.quiz-result-share__copy type="button" onclick="copyLink()" title="Kopiuj link"
                i.bi.bi-clipboard

    = render 'shared/app_version'

css:
  .quiz-result-section {
    display: flex;
    justify-content: center;
    align-items: center;
    padding: 40px 24px;
    min-height: calc(100vh - 80px);
  }

  .quiz-result-container {
    text-align: center;
    max-width: 500px;
    width: 100%;
    padding: 48px 32px;
    background: var(--surface-primary);
    border: 1px solid var(--border-muted);
    border-radius: 24px;
  }

  .quiz-result-icon {
    font-size: 80px;
    margin-bottom: 24px;
    line-height: 1;
  }

  .quiz-result-title {
    font-size: 32px;
    font-weight: 700;
    color: var(--content-primary);
    margin: 0 0 16px;
  }

  .quiz-result-score {
    font-size: 18px;
    color: var(--content-secondary);
    margin: 0 0 8px;
  }

  .quiz-result-score strong {
    color: var(--button-primary);
  }

  .quiz-result-message {
    font-size: 16px;
    color: var(--content-tertiary);
    margin: 0 0 32px;
    line-height: 1.5;
  }

  .quiz-result-details {
    display: flex;
    justify-content: center;
    gap: 32px;
    margin-bottom: 32px;
    padding: 20px;
    background: var(--surface-secondary);
    border-radius: 12px;
  }

  .quiz-result-stat {
    display: flex;
    flex-direction: column;
    gap: 4px;
  }

  .quiz-result-stat__label {
    font-size: 12px;
    color: var(--content-tertiary);
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .quiz-result-stat__value {
    font-size: 24px;
    font-weight: 700;
    color: var(--content-primary);
  }

  .quiz-result-stat__value.text-success {
    color: var(--state-success);
  }

  .quiz-result-stat__value.text-error {
    color: var(--state-error);
  }

  .quiz-result-actions {
    display: flex;
    justify-content: center;
    gap: 16px;
  }

  .quiz-result-link {
    padding: 14px 32px;
    font-size: 14px;
    font-weight: 600;
    color: var(--content-secondary);
    text-decoration: none;
    border: 1px solid var(--border-muted);
    border-radius: 8px;
    transition: background 0.2s ease;
  }

  .quiz-result-link:hover {
    background: var(--surface-secondary);
  }

  .quiz-result-btn {
    padding: 14px 32px;
    font-size: 14px;
    font-weight: 600;
    background: var(--button-primary);
    color: white;
    border: none;
    border-radius: 8px;
    cursor: pointer;
    text-decoration: none;
    transition: background 0.2s ease;
  }

  .quiz-result-btn:hover:not(:disabled) {
    background: var(--button-primary-hover);
  }

  .quiz-result-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
  }

  .quiz-result-share {
    margin-top: 32px;
    padding-top: 32px;
    border-top: 1px solid var(--border-muted);
  }

  .quiz-result-share__title {
    font-size: 18px;
    font-weight: 600;
    color: var(--content-primary);
    margin: 0 0 8px;
  }

  .quiz-result-share__text {
    font-size: 14px;
    color: var(--content-tertiary);
    margin: 0 0 20px;
  }

  .quiz-result-share__qr {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
  }

  .quiz-result-share__qr svg {
    width: 150px;
    height: 150px;
    border-radius: 8px;
    background: white;
    padding: 8px;
  }

  .quiz-result-share__link {
    display: flex;
    gap: 8px;
    max-width: 400px;
    margin: 0 auto;
  }

  .quiz-result-share__input {
    flex: 1;
    padding: 10px 14px;
    font-size: 13px;
    border: 1px solid var(--border-muted);
    border-radius: 6px;
    background: var(--surface-secondary);
    color: var(--content-primary);
  }

  .quiz-result-share__copy {
    padding: 10px 16px;
    background: var(--surface-tertiary);
    border: 1px solid var(--border-muted);
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.2s;
  }

  .quiz-result-share__copy:hover {
    background: var(--surface-secondary);
  }

javascript:
  function copyLink() {
    const input = document.getElementById('certificate-link');
    if (input) {
      navigator.clipboard.writeText(input.value).then(() => {
        const btn = document.querySelector('.quiz-result-share__copy');
        if (btn) {
          btn.innerHTML = '<i class="bi bi-check2"></i>';
          setTimeout(() => {
            btn.innerHTML = '<i class="bi bi-clipboard"></i>';
          }, 2000);
        }
      });
    }
  }

