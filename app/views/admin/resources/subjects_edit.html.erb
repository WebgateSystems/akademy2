<% content_for :page_title, "Subjects" %>

<section aria-label="Edit subject">
  <header class="schools-page__header">
    <h2 style="margin: 0; font-size: 24px; font-weight: 600;">
      Edit: <%= @record.title %>
    </h2>
    <div style="display: flex; gap: 12px;">
      <button type="submit" form="subject-form" class="schools-page__add" style="cursor: pointer; border: none;">
        Update
      </button>
      <%= link_to admin_resource_path(resource: 'subjects', id: @record.id), class: "schools-page__add", style: "text-decoration: none; background: var(--surface-secondary); color: var(--content-primary);" do %>
        Cancel
      <% end %>
    </div>
  </header>

  <div class="schools-card" style="margin-top: 24px;">
    <%= form_with model: @record, url: admin_update_resource_path(resource: 'subjects', id: @record.id), method: :patch, local: true, multipart: true, id: 'subject-form' do |f| %>
      <% if @record.errors.any? %>
        <div style="padding: 16px; margin: 24px; background: var(--surface-error); border-radius: 8px; color: var(--content-error);">
          <strong>Errors:</strong>
          <ul style="margin: 8px 0 0 0; padding-left: 20px;">
            <% @record.errors.full_messages.each do |message| %>
              <li><%= message %></li>
            <% end %>
          </ul>
        </div>
      <% end %>

      <table class="schools-page__table">
        <tbody>
          <tr>
            <td class="left" style="font-weight: 500; color: var(--content-secondary);">
              Icon:
            </td>
            <td class="left">
              <div style="display: flex; flex-direction: column; gap: 8px;">
                <% if @record.icon.present? && @record.icon.url.present? %>
                  <div id="subject-icon-preview" style="margin-bottom: 8px;">
                    <img id="subject-icon-img" src="<%= @record.icon.url %>" alt="Current icon" style="max-width: 64px; max-height: 64px; background: transparent;">
                  </div>
                <% else %>
                  <div id="subject-icon-preview" style="margin-bottom: 8px; display: none;">
                    <img id="subject-icon-img" src="" alt="Current icon" style="max-width: 64px; max-height: 64px; background: transparent;">
                  </div>
                <% end %>
                <%= f.file_field :icon, accept: "image/*", style: "padding: 8px 12px; background: var(--surface-primary); border: 1px solid var(--border-primary); border-radius: 4px; color: var(--content-primary); font-size: 14px; width: 100%; max-width: 300px;", onchange: "previewIcon(this)" %>
                <% if @record.icon.present? && @record.icon.url.present? %>
                  <label style="display: flex; align-items: center; gap: 8px; font-size: 14px; color: var(--content-secondary); cursor: pointer;">
                    <%= check_box_tag "subject[remove_icon]", "1", false, id: "remove_icon" %>
                    Remove icon
                  </label>
                <% end %>
                <small style="color: var(--content-secondary); font-size: 12px;">Accepted formats: SVG, PNG, JPG. Max size: 2MB.</small>
              </div>
            </td>
          </tr>

          <tr>
            <td class="left" style="font-weight: 500; color: var(--content-secondary);">
              Title:
            </td>
            <td class="left">
              <%= f.text_field :title, style: "padding: 8px 12px; background: var(--surface-primary); border: 1px solid var(--border-primary); border-radius: 4px; color: var(--content-primary); font-size: 14px; width: 100%; max-width: 300px;" %>
            </td>
          </tr>

          <tr>
            <td class="left" style="font-weight: 500; color: var(--content-secondary);">
              Slug:
            </td>
            <td class="left">
              <%= f.text_field :slug, style: "padding: 8px 12px; background: var(--surface-primary); border: 1px solid var(--border-primary); border-radius: 4px; color: var(--content-primary); font-size: 14px; width: 100%; max-width: 300px;" %>
            </td>
          </tr>

          <tr>
            <td class="left" style="font-weight: 500; color: var(--content-secondary);">
              Color Light:
            </td>
            <td class="left">
              <div style="display: flex; align-items: center; gap: 8px;">
                <%= f.text_field :color_light, type: "color", style: "padding: 4px; background: var(--surface-primary); border: 1px solid var(--border-primary); border-radius: 4px; width: 60px; height: 40px; cursor: pointer;" %>
                <code style="font-size: 12px; color: var(--content-secondary);"><%= @record.color_light || 'N/A' %></code>
              </div>
            </td>
          </tr>

          <tr>
            <td class="left" style="font-weight: 500; color: var(--content-secondary);">
              Color Dark:
            </td>
            <td class="left">
              <div style="display: flex; align-items: center; gap: 8px;">
                <%= f.text_field :color_dark, type: "color", style: "padding: 4px; background: var(--surface-primary); border: 1px solid var(--border-primary); border-radius: 4px; width: 60px; height: 40px; cursor: pointer;" %>
                <code style="font-size: 12px; color: var(--content-secondary);"><%= @record.color_dark || 'N/A' %></code>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    <% end %>
  </div>
</section>

<script>
  function previewIcon(input) {
    const preview = document.getElementById('subject-icon-preview');
    const img = document.getElementById('subject-icon-img');
    
    if (input.files && input.files[0]) {
      const reader = new FileReader();
      reader.onload = function(e) {
        img.src = e.target.result;
        preview.style.display = 'block';
      };
      reader.readAsDataURL(input.files[0]);
    }
  }
</script>
